{"version":3,"sources":["webpack:///./src/components/modules/video/VideoModule.vue?f0ff","webpack:///./src/components/modules/video/VideoDrawer.vue?c2b5","webpack:///src/components/modules/video/VideoDrawer.vue","webpack:///./src/components/modules/video/VideoDrawer.vue?7a2c","webpack:///./src/components/modules/video/VideoDrawer.vue","webpack:///./src/components/modules/video/VideoStream.vue?beae","webpack:///src/components/modules/video/VideoStream.vue","webpack:///./src/components/modules/video/VideoStream.vue?5831","webpack:///./src/components/modules/video/VideoStream.vue","webpack:///src/components/modules/video/VideoModule.vue","webpack:///./src/components/modules/video/VideoModule.vue?414c","webpack:///./src/components/modules/video/VideoModule.vue","webpack:///./node_modules/sdp/sdp.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","Object","keys","videostreams","length","_e","staticClass","attrs","_v","navColor","enabledStreams","on","$event","stopPropagation","toggleDrawer","_l","stream","key","ref","refInFor","_s","name","streamStatus","action","cleanBitrate","statBitrate","statPacketloss","url","webrtcEndpoint","refWidth","updateStatus","updatePacketloss","updateBitrate","staticRenderFns","topColor","model","value","callback","$$v","drawer","expression","scopedSlots","_u","fn","active","$set","data","computed","get","$store","state","core","navDrawer","set","commit","mounted","component","VAlert","VBtn","VCol","VDivider","VIcon","VList","VListItem","VListItemAction","VListItemContent","VListItemSubtitle","VListItemTitle","VNavigationDrawer","VRow","VSwitch","videostream","width","domProps","props","config","type","default","Number","String","lastStats","streaming","watch","handler","logDebug","start","stremaing","pause","stop","beforeDestroy","clearInterval","bitrateInterval","bufferingInterval","setInterval","$emit","janus","connect","then","addPlugin","peerConnection","onicecandidate","event","candidate","sdpMid","sdpMLineIndex","onaddstream","videoElement","srcObject","mediaStreamEvent","play","lastPosition","currentTime","paused","setRemoteDescription","RTCSessionDescription","jsep","createAnswer","setLocalDescription","answer","methods","components","VideoDrawer","VideoStream","actionState","bitrate","resolution","activeStream","enabled","_enabled","window","addEventListener","changeStream","Math","round","$refs","el","clientWidth","VCard","VCardText","VChip","VContainer","VContent","VSystemBar","SDPUtils","random","toString","substr","localCName","generateIdentifier","splitLines","blob","trim","split","map","line","splitSections","parts","part","index","getDescription","sections","getMediaSections","shift","matchPrefix","prefix","filter","indexOf","parseCandidate","substring","foundation","parseInt","protocol","toLowerCase","priority","ip","address","port","i","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","writeCandidate","sdp","push","toUpperCase","join","parseIceOptions","parseRtpMap","parsed","payloadType","clockRate","channels","numChannels","writeRtpMap","codec","pt","undefined","preferredPayloadType","parseExtmap","id","direction","uri","writeExtmap","headerExtension","preferredId","parseFmtp","kv","j","writeFmtp","parameters","params","forEach","param","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","parseSsrcGroup","semantics","ssrcs","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","role","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","tag","cryptoSuite","keyParams","sessionParams","slice","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","pwd","password","writeIceParameters","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","rtpmapline","fmtps","writeRtpDescription","kind","caps","maxptime","extension","parseRtpEncodingParameters","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","apt","encParam","codecPayloadType","rtx","JSON","parse","stringify","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","obj","cname","rsize","reducedSize","compound","mux","parseMsid","spec","track","planB","msidParts","parseSctpDescription","maxMessageSize","parseMLine","maxSizeLine","isNaN","sctpPort","fmt","sctpMapLines","writeSctpDescription","media","sctp","output","generateSessionId","writeSessionBoilerplate","sessId","sessVer","sessUser","sessionId","version","user","writeMediaSection","transceiver","iceGatherer","getLocalParameters","dtlsTransport","rtpSender","rtpReceiver","msid","sendEncodingParameters","getDirection","getKind","isRejected","parseOLine","username","sessionVersion","netType","addressType","isValidSDP","charAt","module","exports"],"mappings":"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","file":"js/VideoModule.56abd720.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('video-drawer'),_c('v-content',[(!Object.keys(_vm.videostreams).length)?_c('v-container',[_c('v-card',{staticClass:\"mx-auto mt-2\"},[_c('v-alert',{attrs:{\"border\":\"left\",\"outlined\":\"\",\"type\":\"info\"}},[_c('span',[_vm._v(\"No Video Streams are defined. Please define a video stream in \"),_c('v-btn',{staticClass:\"ma-2\",attrs:{\"color\":_vm.navColor+' darken-2',\"small\":\"\",\"to\":\"/config/video\"}},[_vm._v(\"Config->Video\")])],1)])],1)],1):_vm._e(),(Object.keys(_vm.videostreams).length && !Object.keys(_vm.enabledStreams).length)?_c('v-container',[_c('v-card',{staticClass:\"mx-auto mt-2\"},[_c('v-alert',{attrs:{\"border\":\"left\",\"outlined\":\"\",\"type\":\"info\"}},[_c('span',[_vm._v(\"There are no enabled Video Streams. Please enable a stream in \"),_c('v-btn',{staticClass:\"ma-2\",attrs:{\"color\":_vm.navColor+' darken-2',\"small\":\"\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.toggleDrawer($event)}}},[_vm._v(\"Stream Control\")])],1)])],1)],1):_vm._e(),_c('v-container',{staticClass:\"pa-2\",attrs:{\"fluid\":\"\"}},[_c('v-row',{attrs:{\"dense\":\"\"}},_vm._l((_vm.videostreams),function(stream){return (stream.enabled)?_c('v-col',{key:stream.key,staticClass:\"px-4\",attrs:{\"xs\":\"12\",\"sm\":\"12\",\"md\":\"12\",\"lg\":\"6\",\"xl\":\"6\"}},[_c('v-row',{ref:'layout-'+stream.key,refInFor:true,attrs:{\"justify\":\"center\",\"wrap\":\"\"}},[_c('v-card',[_c('v-system-bar',{attrs:{\"color\":\"primary\",\"window\":\"\"}},[_c('span',[_vm._v(\"Video Stream: \"),_c('strong',[_vm._v(_vm._s(stream.name))])])]),_c('v-card-text',[(_vm.streamStatus[stream.key]=='playing')?_c('v-chip',{staticClass:\"ma-2\",attrs:{\"small\":\"\",\"color\":\"success\"}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-check-circle\")]),_c('span',[_vm._v(\"Playing\")])],1):(_vm.streamStatus[stream.key]=='buffering' || stream.action == 'stop')?_c('v-chip',{staticClass:\"ma-2\",attrs:{\"small\":\"\",\"color\":\"amber\"}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-alert\")]),_c('span',[_vm._v(\"Buffering\")])],1):_c('v-chip',{staticClass:\"ma-2\",attrs:{\"small\":\"\",\"color\":\"error\"}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-alert-circle\")]),_c('span',[_vm._v(\"Stopped\")])],1),_c('span',[_vm._v(\"Bitrate\"),_c('v-chip',{staticClass:\"ma-2\",attrs:{\"small\":\"\",\"color\":\"primary\"}},[_c('strong',[_vm._v(_vm._s(_vm.cleanBitrate(_vm.statBitrate[stream.key])))])])],1),_c('span',[_vm._v(\"Packet Loss\"),_c('v-chip',{staticClass:\"ma-2\",attrs:{\"small\":\"\",\"color\":\"error\"}},[_c('strong',[_vm._v(_vm._s(_vm.statPacketloss[stream.key]))])])],1)],1),_c('VideoStream',{attrs:{\"config\":{ url: stream.webrtcEndpoint },\"videostream\":stream.key,\"width\":_vm.refWidth('layout-'+stream.key),\"stream\":1,\"action\":stream.action},on:{\"status\":function($event){return _vm.updateStatus(stream.key, $event)},\"packetloss\":function($event){return _vm.updatePacketloss(stream.key, $event)},\"bitrate\":function($event){return _vm.updateBitrate(stream.key, $event)}}})],1)],1)],1):_vm._e()}),1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-navigation-drawer',{attrs:{\"app\":\"\",\"left\":\"\",\"clipped\":\"\",\"floating\":\"\",\"color\":_vm.topColor},model:{value:(_vm.drawer),callback:function ($$v) {_vm.drawer=$$v},expression:\"drawer\"}},[_c('v-list-item',{staticClass:\"mt-4\"},[_c('v-list-item-content',[_c('v-list-item-title',{staticClass:\"title\"},[_c('v-row',[_c('v-col',[_c('span',[_vm._v(\"Video Streams\")])]),_c('v-col',[_c('v-btn',{attrs:{\"to\":\"/config/video\",\"color\":\"primary\",\"small\":\"\"}},[_c('v-icon',[_vm._v(\"mdi-cog-outline\")])],1)],1)],1)],1),_c('v-list-item-subtitle',[_c('span',[_vm._v(\"Stream Control\")])])],1)],1),_c('v-divider'),(Object.keys(_vm.videostreams).length)?_c('v-list',{attrs:{\"flat\":\"\",\"three-line\":\"\"}},_vm._l((_vm.videostreams),function(stream){return _c('v-list-item',{key:stream.key,scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar active = ref.active;\nreturn [_c('v-list-item-action',[_c('v-switch',{attrs:{\"color\":\"primary\"},model:{value:(stream.enabled),callback:function ($$v) {_vm.$set(stream, \"enabled\", $$v)},expression:\"stream.enabled\"}})],1),_c('v-list-item-content',[_c('v-list-item-title',[_vm._v(_vm._s(stream.name))]),_c('v-list-item-subtitle',[_vm._v(_vm._s(stream.webrtcEndpoint))])],1)]}}],null,true)})}),1):_c('v-list',[_c('v-list-item',[_c('v-list-item-content',[_c('v-alert',{attrs:{\"outlined\":\"\",\"type\":\"info\"}},[_c('span',[_vm._v(\"No Video Streams are defined.\")])])],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang='pug'>\nv-navigation-drawer(app left clipped floating v-model=\"drawer\" :color=\"topColor\")\n  v-list-item.mt-4\n    v-list-item-content\n      v-list-item-title.title\n        v-row\n          v-col\n            span Video Streams\n          v-col\n            v-btn(to='/config/video' color=\"primary\" small)\n              v-icon mdi-cog-outline\n      v-list-item-subtitle\n        span Stream Control\n  v-divider\n  v-list(v-if=\"Object.keys(videostreams).length\" flat three-line)\n    v-list-item(v-for=\"stream in videostreams\" :key=\"stream.key\")\n      template(v-slot:default=\"{ active }\")\n        v-list-item-action\n          v-switch(color='primary' v-model='stream.enabled')\n        v-list-item-content\n          v-list-item-title {{ stream.name }}\n          v-list-item-subtitle {{ stream.webrtcEndpoint }}\n  v-list(v-else)\n    v-list-item\n      v-list-item-content\n        v-alert(outlined type=\"info\")\n          span No Video Streams are defined.\n\n</template>\n\n<script>\nexport default {\n  name: 'VideoDrawer',\n  data () {\n    return {}\n  },\n  computed: {\n    drawer: {\n      get () {\n        return this.$store.state.core.navDrawer\n      },\n      set (value) {\n        this.$store.commit('core/setNavDrawer', value)\n      }\n    },\n    videostreams () {\n      return this.$store.state.data.videostreams\n    }\n  },\n  mounted () {\n  }\n}\n</script>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoDrawer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoDrawer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./VideoDrawer.vue?vue&type=template&id=cd0e3f5e&lang=pug&\"\nimport script from \"./VideoDrawer.vue?vue&type=script&lang=js&\"\nexport * from \"./VideoDrawer.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAlert } from 'vuetify/lib/components/VAlert';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VList } from 'vuetify/lib/components/VList';\nimport { VListItem } from 'vuetify/lib/components/VList';\nimport { VListItemAction } from 'vuetify/lib/components/VList';\nimport { VListItemContent } from 'vuetify/lib/components/VList';\nimport { VListItemSubtitle } from 'vuetify/lib/components/VList';\nimport { VListItemTitle } from 'vuetify/lib/components/VList';\nimport { VNavigationDrawer } from 'vuetify/lib/components/VNavigationDrawer';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSwitch } from 'vuetify/lib/components/VSwitch';\ninstallComponents(component, {VAlert,VBtn,VCol,VDivider,VIcon,VList,VListItem,VListItemAction,VListItemContent,VListItemSubtitle,VListItemTitle,VNavigationDrawer,VRow,VSwitch})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('video',{staticClass:\"ma2 pa0\",attrs:{\"id\":_vm.videostream,\"controls\":\"\",\"autoPictureInPicture\":\"\",\"muted\":\"\",\"preload\":\"none\",\"poster\":\"/img/placeholders/video-placeholder.png\",\"width\":_vm.width},domProps:{\"muted\":true}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang='pug'>\n  video.ma2.pa0(:id='videostream' controls autoPictureInPicture=true muted=true preload=\"none\" poster=\"/img/placeholders/video-placeholder.png\" :width=\"width\")\n</template>\n\n<script>\n/* Note: you may need to add `externals: { ws: \"WebSocket\"},` to Your webpack configuration for this to work properly */\nimport { Janus, StreamingJanusPlugin } from '@techteamer/janus-api'\n\nexport default {\n  props: {\n    config: {\n      type: Object,\n      default: null\n    },  \n    stream: {\n      type: Number,\n      default: null\n    },\n    width: {\n      type: Number,\n      default: 500\n    },\n    videostream: {\n      type: String,\n      default: null\n    },\n    action: {\n      type: String,\n      default: null\n    }\n  },\n\n  data () {\n    return {\n      lastStats: null,\n      streaming: null\n    }\n  },\n\n  watch: {\n    action: {\n      handler: function (newValue) {\n        this.logDebug(`action: ${newValue}, ${this.action}`)\n        if (this.action == 'start') {\n          this.streaming.start()\n        } else if (this.action == 'pause') {\n          this.stremaing.pause()\n        } else if (this.action == 'stop') {\n          this.streaming.stop()\n        }\n      }\n    }\n  },\n\n  beforeDestroy () {\n    clearInterval(this.bitrateInterval)\n    clearInterval(this.bufferingInterval)\n  },\n  \n  mounted () {\n    let janus = this.janus = new Janus(this.config, console)\n    this.streaming = new StreamingJanusPlugin(console, false)\n    let peerConnection = new RTCPeerConnection()\n    let bitrate = 0\n    let packetloss = 0\n    this.bitrateInterval = setInterval(() => {\n\n    let selector = peerConnection.getReceivers().find(({kind}) => kind == \"video\");\n    peerConnection.getStats(selector).then((stats => stats.forEach(entry => {\n        if (entry.type == \"inbound-rtp\") {\n          if (this.lastStats) {\n            packetloss = entry.packetsLost\n            bitrate = (entry.bytesReceived - this.lastStats.bytesReceived) / (entry.lastPacketReceivedTimestamp - this.lastStats.lastPacketReceivedTimestamp)\n          }\n          this.lastStats = entry\n        }\n      })))\n      this.$emit('bitrate', bitrate)\n      this.$emit('packetloss', packetloss)\n    }, 1000)\n\n    this.$emit('status', 'init')\n    janus.connect().then(() => {\n      return janus.addPlugin(this.streaming)\n    }).then(() => {\n      // console.info('plugin added', janus)\n      peerConnection.onicecandidate = (event) => {\n        // console.log('@onicecandidate', event)\n        if (!event.candidate || !event.candidate.candidate) {\n          this.streaming.candidate({completed: true})\n        } else {\n          this.streaming.candidate({\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex\n          })\n        }\n      }\n      peerConnection.onaddstream = (mediaStreamEvent) => {\n        let videoElement = document.getElementById(this.videostream)\n        videoElement.srcObject = mediaStreamEvent.stream\n        videoElement.play()\n        if (this.bufferingInterval == undefined) {\n          let lastPosition = 0\n          this.bufferintInterval = setInterval(() => {\n            if (lastPosition == videoElement.currentTime && !videoElement.paused) {\n              this.$emit('status', 'buffering')\n            } else {\n              this.$emit('status', 'playing')\n            }\n            lastPosition = videoElement.currentTime\n          }, 500)\n        }\n      }\n      // streaming.on('webrtcState', (a, b) => { console.log('webrtcState', a, b) })\n      // streaming.on('mediaState', (a, b) => { console.log('mediaState', a, b) })\n      this.streaming.on('statusChange', (status) => {\n        // console.log('statusChange', status)\n        this.$emit('status', status)\n      })\n      return this.streaming.watch(this.stream)\n    }).then((jsep) => {\n      return peerConnection.setRemoteDescription(new RTCSessionDescription(jsep))\n    }).then(() => {\n      // console.log('remoteDescription set')\n      return peerConnection.createAnswer({offerToReceiveAudio: true, offerToReceiveVideo: true})\n    }).then(answer => {\n      // console.log('answerCreated', answer)\n      peerConnection.setLocalDescription(answer)\n      return this.streaming.start(answer)\n    }).then(({body, json}) => {\n      // console.log('START', body, json)\n    })\n  },\n\n  methods: {\n\n  }\n}\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./VideoStream.vue?vue&type=template&id=cb83b216&lang=pug&\"\nimport script from \"./VideoStream.vue?vue&type=script&lang=js&\"\nexport * from \"./VideoStream.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template lang='pug'>\ndiv\n  video-drawer\n  v-content\n    v-container(v-if=\"!Object.keys(videostreams).length\")\n      v-card.mx-auto.mt-2\n        v-alert(border=\"left\" outlined type=\"info\")\n          span No Video Streams are defined.  Please define a video stream in <v-btn class=\"ma-2\" :color=\"navColor+' darken-2'\" small to='/config/video'>Config->Video</v-btn>\n    v-container(v-if=\"Object.keys(videostreams).length && !Object.keys(enabledStreams).length\")\n      v-card.mx-auto.mt-2\n        v-alert(border=\"left\" outlined type=\"info\")\n          span There are no enabled Video Streams.  Please enable a stream in <v-btn class=\"ma-2\" :color=\"navColor+' darken-2'\" small @click.stop=\"toggleDrawer\">Stream Control</v-btn>\n    v-container.pa-2(fluid)\n        v-row(dense)\n          v-col.px-4(v-for=\"stream in videostreams\" :key='stream.key' v-if=\"stream.enabled\" xs=12 sm=12 md=12 lg=6 xl=6)\n            v-row(justify='center' wrap :ref=\"'layout-'+stream.key\")\n              v-card\n                v-system-bar(color=\"primary\" window)\n                  span Video Stream: <strong>{{ stream.name }}</strong>\n                v-card-text\n                  v-chip.ma-2(v-if=\"streamStatus[stream.key]=='playing'\" small color='success')\n                    v-icon(left) mdi-check-circle\n                    span Playing\n                  v-chip.ma-2(v-else-if=\"streamStatus[stream.key]=='buffering' || stream.action == 'stop'\" small color='amber')\n                    v-icon(left) mdi-alert\n                    span Buffering\n                  v-chip.ma-2(v-else small color='error')\n                    v-icon(left) mdi-alert-circle\n                    span Stopped\n                  span Bitrate\n                    v-chip.ma-2(small color='primary') <strong>{{ cleanBitrate(statBitrate[stream.key]) }}</strong>\n                  span Packet Loss\n                    v-chip.ma-2(small color='error') <strong>{{ statPacketloss[stream.key] }}</strong>\n                VideoStream(:config=\"{ url: stream.webrtcEndpoint }\" :videostream=\"stream.key\" :width=\"refWidth('layout-'+stream.key)\" :stream=\"1\" :action=\"stream.action\" @status=\"updateStatus(stream.key, $event)\" @packetloss=\"updatePacketloss(stream.key, $event)\" @bitrate=\"updateBitrate(stream.key, $event)\")\n                // v-card-text\n                  v-layout.d-flex.justify-space-between(flat)\n                    // div\n                      v-btn-toggle.ma-2(v-model=\"actionState\" shaped mandatory dense)\n                        v-btn(color='green' @click=\"stream.action='start'\")\n                          v-icon(left) mdi-play\n                          span Start\n                        v-btn(color='red' @click=\"stream.action='stop'\")\n                          v-icon(left) mdi-stop\n                          span Stop\n                  // span BitRate\n                    v-btn-toggle.ma-2(v-model=\"bitrate\" mandatory background-color='blue' active-class='blue' dense)\n                      v-btn(value='128') 128K\n                      v-btn(value='256') 256K\n                      v-btn(value='512') 512K\n                      v-btn(value='1024') 1M\n                      v-btn(value='2048') 2M\n                  // div\n                    span Resolution\n                    v-btn-toggle.ma-2(v-model=\"resolution\" mandatory background-color='purple' active-class='purple' dense)\n                      v-btn(value='480p') 480p\n                      v-btn(value='720p') 720p\n                      v-btn(value='1080p') 1080p\n                      v-btn(value='2k') 2k\n                      v-btn(value='4k') 4k\n</template>\n\n<script>\nimport VideoDrawer from './VideoDrawer'\nimport VideoStream from './VideoStream.vue'\n\nexport default {\n  name: 'VideoModule',\n  components: {\n    VideoDrawer,\n    VideoStream\n  },\n  data () {\n    return {\n      actionState: 'start',\n      streamStatus: {'nano': null, 'raspberry': null},\n      statBitrate: {'nano': null, 'raspberry': null},\n      statPacketloss: {'nano': null, 'raspberry': null},\n      bitrate: '256',\n      resolution: '720p',\n      activeStream: null,\n      width: 500\n    }\n  },\n  computed: {\n    videostreams () {\n      return this.$store.state.data.videostreams\n    },\n    enabledStreams () {\n      let _enabled = {}\n      for (const stream in this.videostreams) {\n        if (this.videostreams[stream].enabled) {\n          _enabled[this.videostreams[stream].key] = this.videostreams[stream]\n        }\n      }\n      return _enabled\n    }\n  },\n  watch: {\n  },\n  mounted () {\n    window.addEventListener('resize', () => {\n      this.width = ((75 / 100) * window.innerWidth)\n    })\n  },\n  methods: {\n    updateStatus (key, $event) {\n      if (!(this.streamStatus.hasOwnProperty(key))) {\n        this.$set(this.streamStatus, key, $event)\n      } else {\n        this.streamStatus[key] = $event\n      }\n    },\n    updateBitrate (key, $event) {\n      if (!(this.statBitrate.hasOwnProperty(key))) {\n        this.$set(this.statBitrate, key, $event)\n      } else {\n        this.statBitrate[key] = $event\n      }\n    },\n    updatePacketloss (key, $event) {\n      if (!(this.statPacketloss.hasOwnProperty(key))) {\n        this.$set(this.statPacketloss, key, $event)\n      } else {\n        this.statPacketloss[key] = $event\n      }\n    },\n    changeStream (stream) {\n      this.activeStream = stream\n    },\n    cleanBitrate (bitrate) {\n      if (bitrate / 1000 < 1000) {\n        return Math.round(bitrate / 1000) + ' K'\n      } else {\n        return Math.round(bitrate / 1000000) + ' M'\n      }\n    },\n    refWidth (el) {\n      let width = null\n      try {\n        width = this.$refs[el][0].clientWidth\n      } catch (err) {\n\n      }\n      return width\n    },\n    toggleDrawer () {\n      this.$store.commit('core/setNavDrawer', true)\n    }\n  }\n}\n</script>\n\n<style scoped>\n</style>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoModule.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoModule.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./VideoModule.vue?vue&type=template&id=c1f6fba6&scoped=true&lang=pug&\"\nimport script from \"./VideoModule.vue?vue&type=script&lang=js&\"\nexport * from \"./VideoModule.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"c1f6fba6\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAlert } from 'vuetify/lib/components/VAlert';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VContent } from 'vuetify/lib/components/VContent';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSystemBar } from 'vuetify/lib/components/VSystemBar';\ninstallComponents(component, {VAlert,VBtn,VCard,VCardText,VChip,VCol,VContainer,VContent,VIcon,VRow,VSystemBar})\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  var parts = keyParams.substr(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES paramters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  var pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substr(12),\n    password: pwd.substr(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n"],"sourceRoot":""}